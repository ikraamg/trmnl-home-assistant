# PostgreSQL 16 Configuration for BYOS Terminus
# Optimized for Raspberry Pi 4 with 2GB container budget
# Prioritizes SD card longevity over durability

# =============================================================================
# Memory (350-400MB total footprint)
# =============================================================================
shared_buffers = 384MB
work_mem = 4MB
maintenance_work_mem = 64MB
effective_cache_size = 1GB
huge_pages = off
max_connections = 20

# =============================================================================
# WAL - Minimize SD card writes
# =============================================================================
wal_level = minimal
max_wal_senders = 0
wal_compression = zstd
synchronous_commit = off
commit_delay = 10000
wal_buffers = 12MB
max_wal_size = 256MB
min_wal_size = 64MB
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9

# =============================================================================
# Autovacuum - Gentle on resources
# =============================================================================
autovacuum_max_workers = 2
autovacuum_naptime = 1min
autovacuum_vacuum_cost_delay = 20ms
autovacuum_vacuum_cost_limit = 200

# =============================================================================
# Query planner - SD card aware
# =============================================================================
random_page_cost = 2.0
effective_io_concurrency = 1

# =============================================================================
# Logging
# =============================================================================
log_destination = 'stderr'
logging_collector = off
log_min_messages = warning
log_min_error_statement = error

# =============================================================================
# Connection settings
# =============================================================================
listen_addresses = 'localhost'
port = 5432
unix_socket_directories = '/var/run/postgresql'

# =============================================================================
# Locale
# =============================================================================
lc_messages = 'C'
lc_monetary = 'C'
lc_numeric = 'C'
lc_time = 'C'
