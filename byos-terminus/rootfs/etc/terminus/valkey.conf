# Valkey Configuration for BYOS Terminus
# Optimized for Sidekiq job queue safety and SD card longevity

# =============================================================================
# Network - Unix socket only (50% faster than TCP localhost)
# =============================================================================
# Socket is created at runtime via command line args
port 0
bind 127.0.0.1

# =============================================================================
# Memory - CRITICAL: noeviction for Sidekiq job safety
# =============================================================================
maxmemory 128mb
maxmemory-policy noeviction

# =============================================================================
# Persistence - AOF only, SD-friendly
# =============================================================================
# Append-only file for durability
appendonly yes
appendfsync everysec
no-appendfsync-on-rewrite yes
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 32mb
aof-use-rdb-preamble yes

# Disable RDB snapshots (reduces SD card wear)
save ""

# =============================================================================
# Shutdown behavior
# =============================================================================
shutdown-timeout 10

# =============================================================================
# Logging
# =============================================================================
loglevel notice

# =============================================================================
# Misc
# =============================================================================
daemonize no
supervised no
pidfile ""
databases 16
